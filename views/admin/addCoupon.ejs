<!DOCTYPE HTML>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <title>FURNIX Admin</title>

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/admin-assets/imgs/theme/favicon-16x16.png">

    <!-- Template CSS -->
    <link href="/admin-assets/css/main.css" rel="stylesheet" type="text/css" />
</head>
<style>
    .custom-button1 {
        width: 100px;
        height: 40px;
        padding: 5px;
        background-color: rgb(255, 255, 255);
        color: rgb(0, 0, 0);
        font-size: 14px;
        border-radius: 50px;
    }

    .custom-button2 {
        width: 100px;
        height: 40px;
        padding: 5px;
        background-color: rgb(0, 0, 0);
        color: rgb(255, 255, 255);
        font-size: 14px;
        border-radius: 50px;
    }
</style>

<body>


    <header class="main-header navbar">
        <div class="col-search">
        </div>
        <div class="col-nav">
            <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"> <i
                    class="material-icons md-apps"></i> </button>
            <ul class="nav">
                <li class="dropdown nav-item">
                    <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownAccount"
                        aria-expanded="false"> <img class="img-xs rounded-circle"
                            src="/admin-assets/imgs/people/profile.jpg" alt="User"></a>
                    <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAccount">
                        <a class="dropdown-item text-danger" href="/admin/adminLogout"><i
                                class="material-icons md-exit_to_app"></i>Logout</a>
                    </div>
                </li>
            </ul>
        </div>
    </header>
    <section class="content-main">
            <div class="row justify-content-center">
                <div class="content-header">
                    <h2 class="content-title fw-bold" style="margin: auto;">Add new coupon</h2>
                </div>
                <div class="col-lg-6">
                    <div class="card mb-4">
                        <div class="card-body">


                            <div class="mb-4">
                                <label for="product_name" class="form-label">Name*</label>
                                <input type="text" placeholder="Enter coupon name" class="form-control" id="couponName" name="name" onkeydown="nameclear()">
                            </div>
                            <p class="text-danger text-center mb-15 " id="minName"></p>
                            <div class="row">
                                <div class="col-lg-6">
                                    <label class="form-label">Starting date &nbsp; (Default current date)</label>
                                    <input type="date" placeholder="Enter starting date" class="form-control" id="startingDate">
                                    <p class="text-danger text-center mb-15 " id="startingDateError"></p>
                                </div>
                                <div class="col-lg-6">
                                    <label class="form-label">Ending date &nbsp; (Default no expiary date)</label>
                                    <input type="date" placeholder="Enter starting date" class="form-control" id="endingDate">
                                    <p class="text-danger text-center mb-15 " id="endingDateError"></p>
                                </div>
                                <div class="col-lg-6" style="margin-top: 20px;">
                                    <label class="form-label">Minimum order amount &nbsp; (Default 0 amount)</label>
                                    <input type="text" placeholder="Enter minimum order amount" class="form-control" id="minimumAmount">
                                    <p class="text-danger text-center mb-15 " id="materialError"></p>
                                </div>
                                <div class="col-lg-6" style="margin-top: 20px;">
                                    <label class="form-label">Discount amount*</label>
                                    <input type="text" placeholder="Enter discount amount" class="form-control" id="discountamount" onkeydown="amountclear()">
                                    <p class="text-danger text-center mb-15 " id="discounterror"></p>
                                </div>
                                <div class="col-lg-6" style="margin-top: 20px;">
                                    <label class="form-label">Discount amount*</label>
                                    <select class="form-control" id="couponType">
                                        <option value="Special">Special coupon</option>
                                        <option value="Regular">Regular coupon</option>
                                    </select>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="mb-50 text-center">
                    <button class="custom-button1" onclick="cancel()">Cancel</button>
                    <button class="custom-button2" onclick="validation()">Add</button>
                </div>
            </div>
    </section>
    </main>
    <script src="/admin-assets/js/vendors/jquery-3.6.0.min.js"></script>
    <script src="/admin-assets/js/vendors/bootstrap.bundle.min.js"></script>
    <script src="/admin-assets/js/vendors/select2.min.js"></script>
    <script src="/admin-assets/js/vendors/perfect-scrollbar.js"></script>
    <script src="/admin-assets/js/vendors/jquery.fullscreen.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/admin-assets/js/main.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</body>

<script>

    function validation() {

        const name = document.getElementById("couponName").value;
        const startingDate = document.getElementById("startingDate").value;
        const endingDate = document.getElementById("endingDate").value;
        const minimumAmount = document.getElementById("minimumAmount").value;
        const discountamount = document.getElementById("discountamount").value;
        const couponType = document.getElementById("couponType").value;
        
        const nameError = document.getElementById("minName");
        const discounterror = document.getElementById("discounterror");
        nameError.textContent = "";
        discounterror.textContent = "";

        // name validation
        if (name.trim() === "") {
            nameError.textContent = "Please enter valid name"
        } else if (name.length <= 3) {
            nameError.textContent = "Name must need atleast 3 character"
        } else if (name.length >= 20) {
            nameError.textContent = "Name can't exceed 20 character"
        } else if ((!/^[A-Za-z\s]+$/.test(name))) {
            nameError.textContent = "Name can't contain characters other than alphabets"
        }else{
            nameError.textContent = "";
        }

            
            
        if (discountamount.trim() === "") {
            discounterror.textContent = "Discount amount is required"
        } else if (/^\d+$/.test(discountamount)) {
            const capNumber = parseInt(discountamount);
            if (capNumber <= 0) {
                discounterror.textContent = "Discount amount not allowed in zero"
            }
        } else if(!/^\d+$/.test(discountamount)) {
            discounterror.textContent = "Discount amount can't contain characters other numbers"
        } else{
            discounterror.textContent = "";
        }
        if(nameError.textContent === "" && discounterror.textContent === ""){
            $.ajax({
                url: "/admin/addCoupon",
                method: "post",
                data: {
                    name,
                    startingDate,
                    endingDate,
                    minimumAmount,
                    discountamount,
                    couponType
                },
                success: (response) => {
                    if (response.status === "okay") {
                        Swal.fire({
                            icon: "success",
                            title: "Your work has been saved",
                            showConfirmButton: false,
                            timer: 1500
                        });
                        setTimeout(() => {
                            window.history.back()
                        }, 1500);   
                    } else if(response.status === "oops"){
                        Swal.fire({
                            icon: "error",
                            title: "Something wrong",
                            showConfirmButton: false,
                            timer: 1500
                        });
                    }
                }
            })
        }
    }




    function cancel() {
        Swal.fire({
            title: "Are you sure?",
            text: "You want to discard all changes?",
            showCancelButton: true,
            confirmButtonColor: "#000000",
            cancelButtonColor: "#d33",
            confirmButtonText: "Discard"
        }).then((result) => {
            if (result.isConfirmed) {
                window.history.back()
            }
        });
    }

    function nameclear(){
        document.getElementById("minName").textContent = ""
    }
    function amountclear(){
        document.getElementById("discounterror").textContent = ""
    }

// Get references to the input elements
const startingDateInput = document.getElementById('startingDate');
const endingDateInput = document.getElementById('endingDate');

// Attach event listeners
startingDateInput.addEventListener('change', validateDates);
endingDateInput.addEventListener('change', validateDates);

function validateDates() {
    const startingDate = new Date(startingDateInput.value);
    const endingDate = new Date(endingDateInput.value);
    const currentDate = new Date();

    // Validate starting date
    if (startingDate < currentDate) {
        document.getElementById('startingDateError').innerText = 'Starting date cannot be a previous date';
    } else {
        document.getElementById('startingDateError').innerText = '';
    }

    // Validate ending date
    if (endingDate <= startingDate || endingDate < currentDate) {
        document.getElementById('endingDateError').innerText = 'Ending date cannot be a previous date or the same as or before the starting date';
    } else {
        document.getElementById('endingDateError').innerText = '';
    }
}
</script>
</html>